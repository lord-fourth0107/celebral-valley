# Camera Upload App - Development Commands
# Usage: just <command>

# Default recipe - show available commands
default:
    @just --list

# Setup commands
setup: setup-frontend setup-backend
    @echo "âœ… Setup complete! Ready to develop"

# Install frontend dependencies
setup-frontend:
    @echo "ðŸ“± Installing frontend dependencies..."
    npm install

# Install backend dependencies  
setup-backend:
    @echo "ðŸ–¥ï¸  Installing backend dependencies..."
    cd server && npm install

# Development commands
dev: dev-backend dev-frontend
    @echo "ðŸš€ Starting both frontend and backend..."

# Start backend server in development mode
dev-backend:
    @echo "ðŸ–¥ï¸  Starting backend server..."
    cd server && npm run dev

# Start frontend Expo development server
dev-frontend:
    @echo "ðŸ“± Starting frontend Expo server..."
    npx expo start

# Start backend server in production mode
start-backend:
    @echo "ðŸ–¥ï¸  Starting backend server (production)..."
    cd server && npm start

# Start frontend for web preview
start-web:
    @echo "ðŸŒ Starting frontend for web..."
    npx expo start --web

# Testing and utilities
test-backend:
    @echo "ðŸ§ª Testing backend health..."
    curl -f http://localhost:3000/ || echo "âŒ Backend not responding"

# View uploaded images
list-uploads:
    @echo "ðŸ“‚ Listing uploaded images..."
    curl -s http://localhost:3000/images | jq '.' || echo "âŒ Backend not responding"

# Clean commands
clean: clean-frontend clean-backend
    @echo "ðŸ§¹ Cleaned all build artifacts and dependencies"

clean-frontend:
    @echo "ðŸ§¹ Cleaning frontend..."
    rm -rf node_modules .expo

clean-backend:
    @echo "ðŸ§¹ Cleaning backend..."
    cd server && npm run clean

# Utility commands
kill-servers:
    @echo "ðŸ”ª Killing any running servers..."
    pkill -f "node.*server.js" || true
    pkill -f "expo start" || true

check-ports:
    @echo "ðŸ” Checking if ports are in use..."
    lsof -ti:3000 && echo "Port 3000 (backend) is in use" || echo "Port 3000 (backend) is free"
    lsof -ti:8081 && echo "Port 8081 (expo) is in use" || echo "Port 8081 (expo) is free"

# Build commands (for production deployment)
build-frontend:
    @echo "ðŸ“¦ Building frontend for production..."
    npx expo export

# Help and information
info:
    @echo "ðŸ“‹ Camera Upload App Information:"
    @echo "  Frontend: React Native with Expo"
    @echo "  Backend:  Node.js with Express"
    @echo "  Ports:    Backend (3000), Expo (8081)"
    @echo ""
    @echo "ðŸš€ Quick Start:"
    @echo "  just setup    # Install dependencies"
    @echo "  just dev      # Start development servers"
    @echo ""
    @echo "ðŸ“± Mobile Development:"
    @echo "  - Install Expo Go app on your phone"  
    @echo "  - Scan QR code from 'just dev-frontend'"
    @echo ""
    @echo "ðŸŒ Web Development:"
    @echo "  just start-web   # Test in browser"

# Open useful URLs
open-backend:
    open http://localhost:3000

open-images:
    open http://localhost:3000/images

# Development workflow helpers
restart: kill-servers dev
    @echo "ðŸ”„ Restarted all services"

logs-backend:
    @echo "ðŸ“ Backend logs (last 50 lines):"
    @tail -50 server/uploads/*.log 2>/dev/null || echo "No log files found"